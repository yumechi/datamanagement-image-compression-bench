# ファイル書き込みベンチマーク

## 概要

このプログラムは、「datamanagement」本の執筆のために、ディスクへの大量ファイル書き込み性能を測定するベンチマークツールです。1バイトの小さなファイルを大量に作成し、ファイルシステムの書き込み性能を定量的に評価します。

## 機能

### 主な処理

1. **大量ファイル作成**: 指定されたディレクトリに1バイトのファイルを大量に作成
2. **書き込み性能測定**: ファイル作成開始から完了までの時間を正確に測定
3. **繰り返し実行**: 指定された回数だけベンチマークを繰り返し、統計的な性能評価を実施
4. **データ出力**: 各実行の結果をCSVファイルに記録
5. **自動クリーンアップ**: 各実行後にテストファイルを自動削除してディスク容量を節約

### 出力される測定データ

- **実行回数**: ベンチマーク実行回数
- **書き込み先パス**: ファイルを作成したディレクトリパス
- **ファイル数**: 作成したファイルの総数
- **処理時間**: ファイル作成開始から完了までの時間（ミリ秒）
- **処理速度**: 1秒あたりのファイル作成数

## 技術仕様

- **言語**: Rust
- **ファイルサイズ**: 1バイト（最小単位）
- **ファイル数**: デフォルト100,000ファイル（設定可能）
- **実行回数**: デフォルト10回（設定可能）
- **ファイル命名**: `file_00000000.dat`〜`file_99999999.dat`

## 依存関係

```toml
csv = "1.3"           # CSV出力
serde = "1.0"         # データシリアライゼーション
```

## 実行方法

### 基本実行

```bash
# デフォルト設定で実行（100,000ファイル、10回実行）
cargo run -- /tmp/benchmark

# 別のディスクに書き込み（Fドライブなど）
cargo run -- F:/benchmark

# WSL環境でWindowsのFドライブにアクセス
cargo run -- /mnt/f/benchmark
```

### コマンドライン引数

```bash
# ヘルプを表示
cargo run -- --help

# ファイル数を指定（50,000ファイル、10回実行）
cargo run -- /tmp/benchmark 50000

# ファイル数と実行回数を両方指定（100,000ファイル、5回実行）
cargo run -- /tmp/benchmark 100000 5

# テスト用の小さな実行（1,000ファイル、3回実行）
cargo run -- /tmp/benchmark 1000 3
```

### 使用方法

```
cargo run -- <書き込み先パス> [ファイル数] [実行回数]
```

**引数:**
- `書き込み先パス`: ファイルを作成するディレクトリパス（**必須**）
- `ファイル数`: 各実行で作成するファイル数（デフォルト: 100000）
- `実行回数`: ベンチマークの実行回数（デフォルト: 10）

**注意事項:**
- 書き込み先パスの親ディレクトリが存在する必要があります
- ファイル数と実行回数は正の整数で指定してください
- 各実行後にテストファイルは自動削除されます
- 進捗は10,000ファイルごとに表示されます

## 出力ファイル

- **file_write_benchmark_results.csv**: メインプログラムの測定データが記録されるCSVファイル
- **file_write_benchmark_test_results.csv**: テストプログラム用の測定データファイル

## 利用可能なプログラム

### メインプログラム（file_write_benchmark）
```bash
# フルスケールベンチマーク（デフォルト: 100,000ファイル、10回実行）
cargo run -- /tmp/benchmark

# カスタム設定
cargo run -- /mnt/f/benchmark 50000 5  # 50,000ファイル、5回実行
```

### テストプログラム（test_program）
```bash
# 軽量テスト（デフォルト: 1,000ファイル、3回実行）
cargo run --bin test_program -- /tmp/benchmark

# カスタムテスト
cargo run --bin test_program -- /tmp/benchmark 500 2  # 500ファイル、2回実行
```

## 実行時間の目安

### 標準設定（100,000ファイル×10回）
- **SSD**: 1回あたり約5-15秒（合計50-150秒）
- **HDD**: 1回あたり約30-120秒（合計300-1200秒）
- **ネットワークドライブ**: 環境により大きく変動

### テスト設定（1,000ファイル×3回）
- **SSD**: 合計約1-3秒
- **HDD**: 合計約3-10秒

## プロジェクト目的

本プログラムはファイルシステムの書き込み性能を定量的に測定し、以下の判断材料を提供します：

- **ディスク性能**: SSD、HDD、ネットワークドライブなど異なるストレージの性能比較
- **ファイルシステム性能**: NTFS、ext4、XFSなど異なるファイルシステムの特性評価
- **大量ファイル処理**: 大量の小さなファイルを扱うシステムの性能予測
- **統計的信頼性**: 複数回実行による性能の安定性評価

## 想定されるユースケース

### ストレージ性能比較
- SSD vs HDD
- ローカルディスク vs ネットワークドライブ
- RAID構成の性能評価

### ファイルシステム評価
- NTFS vs ext4 vs XFS
- マウントオプションの影響測定
- ブロックサイズの最適化

### システム設計
- バックアップシステムの性能予測
- ログファイル生成システムの性能評価
- キャッシュストレージの選定

## 期待される結果

### 一般的な性能傾向
- **NVMe SSD**: 10,000-30,000ファイル/秒
- **SATA SSD**: 5,000-15,000ファイル/秒
- **HDD**: 500-2,000ファイル/秒
- **ネットワークドライブ**: 100-1,000ファイル/秒

### 性能に影響する要因
- ディスクの種類（SSD/HDD）
- ファイルシステムの種類
- OSのキャッシュ設定
- ディスクの使用率
- 同時実行中の他のプロセス

## データ管理における意義

書籍「datamanagement」において、本ベンチマークツールは以下の知見を提供します：

- ストレージ選定の定量的な判断基準
- 大量ファイル処理システムの設計指針
- データバックアップ戦略の最適化
- コスト対性能のトレードオフ評価
