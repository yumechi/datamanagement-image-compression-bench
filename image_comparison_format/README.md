# 画像フォーマット比較プログラム

## 概要

このプログラムは、「datamanagement」本の執筆のために、異なる画像フォーマット（PNG、JPG、WebP）のファイルサイズ比較を行うベンチマークツールです。

## 機能

### 主な処理

1. **ランダム画像生成**: ImageMagickを使用して1024x1024のランダムノイズPNG画像を指定枚数生成（4並列処理）
2. **フォーマット変換**: 生成されたPNG画像をJPGとWebPに劣化なし変換（quality=100、4並列処理）
3. **統計計算**: 各フォーマットのファイルサイズ統計を算出
4. **データ出力**: 指定されたラウンド数の実行結果をCSVファイルに出力
5. **自動クリーンアップ**: 各ラウンド後に画像ファイルを自動削除してディスク容量を節約

### 出力される統計データ

- **実行回数**: ベンチマーク実行回数（指定されたラウンド数）
- **フォーマット**: PNG、JPG、WEBP
- **合計サイズ**: 指定枚数の画像の合計ファイルサイズ
- **平均サイズ**: 1枚あたりの平均ファイルサイズ
- **最小サイズ**: 最も小さいファイルサイズ
- **最大サイズ**: 最も大きいファイルサイズ
- **中央値**: ファイルサイズの中央値

## 技術仕様

- **言語**: Rust
- **外部依存**: ImageMagick (`convert`コマンド)
- **画像サイズ**: 1024x1024ピクセル
- **画像数**: 各実行で指定された枚数生成（デフォルト: 100枚）
- **実行回数**: 指定されたラウンド数（デフォルト: 10回）
- **並列処理**: 4並列でタスクを実行し、高速化を実現

## 依存関係

```toml
csv = "1.3"           # CSV出力
serde = "1.0"         # データシリアライゼーション
rand = "0.8"          # ランダム値生成
tokio = "1.0"         # 非同期ランタイム
```

## 実行方法

### 基本実行

```bash
# デフォルト設定で実行（100枚の画像、10ラウンド）
cargo run
```

### コマンドライン引数

```bash
# ヘルプを表示
cargo run -- --help

# 画像枚数を指定（50枚の画像、10ラウンド）
cargo run -- 50

# 画像枚数とラウンド数を両方指定（200枚の画像、5ラウンド）
cargo run -- 200 5

# テスト用の小さな実行（2枚の画像、1ラウンド）
cargo run -- 2 1
```

### 使用方法

```
cargo run -- [画像枚数] [ラウンド数]
```

**引数:**
- `画像枚数`: 各ラウンドで生成する画像の枚数（デフォルト: 100）
- `ラウンド数`: ベンチマークの実行回数（デフォルト: 10）

**注意事項:**
- 画像枚数とラウンド数は正の整数で指定してください
- 4並列処理により、従来より高速に実行されます
- 実験用画像ファイルは統計取得後に自動削除されます

## 出力ファイル

- **image_comparison_format_results.csv**: メインプログラムの統計データが記録されるCSVファイル
- **images_run_N/**: 各実行回数ごとの画像ファイルが格納されるディレクトリ（統計取得後に自動削除）
- **image_comparison_format_test_results.csv**: テストプログラム（test_program）用の統計データファイル

## 前提条件

システムにImageMagickがインストールされている必要があります：

```bash
# Ubuntu/Debian
sudo apt-get install imagemagick

# macOS
brew install imagemagick
```

## 利用可能なプログラム

### メインプログラム（image_comparison_format）
```bash
# フルスケールベンチマーク（デフォルト: 100枚、10ラウンド）
cargo run

# カスタム設定
cargo run -- 50 5  # 50枚、5ラウンド
```

### テストプログラム（test_program）
```bash
# 軽量テスト（デフォルト: 5枚、1ラウンド）
cargo run --bin test_program

# カスタムテスト
cargo run --bin test_program -- 10 2  # 10枚、2ラウンド
```

## プロジェクト目的

本プログラムは画像フォーマットの圧縮効率を比較検討し、データ管理における最適なフォーマット選択のための定量的データを提供することを目的としています。メインプログラムで本格的なベンチマークを、テストプログラムで動作確認や軽量テストを実行できます。