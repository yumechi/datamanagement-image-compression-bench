# データ圧縮フォーマット比較プログラム

## 概要

このプログラムは、「datamanagement」本の執筆のために、各種データ圧縮フォーマットの圧縮効率と処理速度を比較分析するベンチマークツールです。画像ファイルディレクトリを対象に、異なる圧縮形式での圧縮率と処理時間を定量的に測定します。

## 機能

### 主な処理

1. **ベンチマーク画像生成**: ImageMagickを使用して1024x1024のランダムノイズPNG画像を指定枚数生成（4並列処理）
2. **多形式圧縮実行**: 生成された画像ディレクトリを各種圧縮フォーマットで指定回数圧縮
3. **性能測定**: 各圧縮での圧縮率、処理時間、圧縮速度を測定
4. **統計分析**: 複数回実行による統計的な性能評価
5. **自動クリーンアップ**: 実験用ファイルを自動削除してディスク容量を節約

### 対応圧縮フォーマット

- **ZIP**: 汎用的なアーカイブ形式
- **TAR.GZ**: UNIX系標準のgzip圧縮tar
- **ZSTD**: Facebook開発の高性能圧縮
- **XZ**: 高圧縮率のLZMA2ベース
- **7Z**: 7-Zipの高効率圧縮形式

### 出力される統計データ

- **実行回数**: ベンチマーク実行回数
- **フォーマット**: 圧縮形式名
- **元ファイルサイズ**: 圧縮前のディレクトリサイズ
- **圧縮後サイズ**: 圧縮ファイルのサイズ
- **圧縮率**: 圧縮後サイズ/元サイズの比率（小さいほど高圧縮）
- **圧縮時間**: 圧縮処理にかかった時間（ミリ秒）
- **圧縮速度**: MB/秒での処理速度

## 技術仕様

- **言語**: Rust
- **外部依存**: ImageMagick, zip, tar, zstd, xz-utils, p7zip-full
- **画像サイズ**: 1024x1024ピクセル
- **画像数**: デフォルト100枚（設定可能）
- **圧縮回数**: デフォルト100回（設定可能）
- **並列処理**: 画像生成は4並列で高速化

## 依存関係

```toml
csv = "1.3"           # CSV出力
serde = "1.0"         # データシリアライゼーション
rand = "0.8"          # ランダム値生成
tokio = "1.0"         # 非同期ランタイム
```

## 前提条件

システムに以下のコマンドがインストールされている必要があります：

### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install imagemagick zip tar zstd xz-utils p7zip-full
```

### macOS
```bash
brew install imagemagick zstd xz p7zip
# zip, tarは標準でインストール済み
```

## 実行方法

### 基本実行

```bash
# デフォルト設定で実行（100枚の画像、各形式100回圧縮）
cargo run
```

### コマンドライン引数

```bash
# ヘルプを表示
cargo run -- --help

# 画像枚数を指定（50枚の画像、各形式100回圧縮）
cargo run -- 50

# 画像枚数と圧縮回数を両方指定（200枚の画像、各形式50回圧縮）
cargo run -- 200 50

# テスト用の小さな実行（10枚の画像、各形式5回圧縮）
cargo run -- 10 5
```

### 使用方法

```
cargo run -- [画像枚数] [圧縮回数]
```

**引数:**
- `画像枚数`: 圧縮対象の画像枚数（デフォルト: 100）
- `圧縮回数`: 各フォーマットでの圧縮実行回数（デフォルト: 100）

**注意事項:**
- 画像枚数と圧縮回数は正の整数で指定してください
- 5つの圧縮形式×指定回数の処理が実行されます
- 実験用ファイルは各圧縮後に自動削除されます

## 出力ファイル

- **compression_format_comparison_results.csv**: メインプログラムの統計データが記録されるCSVファイル
- **benchmark_images/**: ベンチマーク用画像ファイルが格納されるディレクトリ（実行後に自動削除）
- **compression_format_comparison_test_results.csv**: テストプログラム用の統計データファイル

## 利用可能なプログラム

### メインプログラム（compression_format_comparison）
```bash
# フルスケールベンチマーク（デフォルト: 100枚、各形式100回圧縮）
cargo run

# カスタム設定
cargo run -- 50 50  # 50枚、各形式50回圧縮
```

### テストプログラム（test_program）
```bash
# 軽量テスト（デフォルト: 10枚、各形式3回圧縮、3形式のみ）
cargo run --bin test_program

# カスタムテスト
cargo run --bin test_program -- 20 5  # 20枚、各形式5回圧縮
```

## 実行時間の目安

### 標準設定（100枚×100回×5形式）
- **画像生成**: 約1-2分
- **圧縮テスト**: 約10-30分（システム性能による）
- **合計**: 約30-45分

### テスト設定（10枚×3回×3形式）
- **合計**: 約2-5分

## プロジェクト目的

本プログラムはデータ圧縮技術の比較検討を行い、以下の判断材料を提供します：

- **圧縮効率**: どの形式が最も小さなファイルサイズを実現するか
- **処理速度**: どの形式が最も高速に処理できるか
- **実用性評価**: 圧縮率と速度のバランスからの最適形式選択
- **統計的信頼性**: 複数回実行による性能の安定性評価

## 期待される結果

- **ZIP**: バランスの良い圧縮率と処理速度
- **TAR.GZ**: 標準的な圧縮性能
- **ZSTD**: 高速処理と優れた圧縮率のバランス
- **XZ**: 最高レベルの圧縮率（処理時間は長め）
- **7Z**: 高い圧縮率と多機能性

データ管理戦略において、用途に応じた最適な圧縮形式の選択指針を提供します。